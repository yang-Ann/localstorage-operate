<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <button id="btn1">存储数据</button>
  <button id="btn2">获取数据</button>
  <button id="btn3">数据超时</button>
  <button id="btn4">获取存储数据信息</button>
  <button id="btn5">清除存储数据</button>

  <script type="module">
    import LocalstorageOperate from "./lib/bundle.esm.js";

    const btn1 = document.getElementById("btn1");
    const btn2 = document.getElementById("btn2");
    const btn3 = document.getElementById("btn3");
    const btn4 = document.getElementById("btn4");
    const btn5 = document.getElementById("btn5");

    // web 平台, 数据默认超时 1000ms
    const instance = new LocalstorageOperate("web", 1000);

    btn1.onclick = () => {
      instance.setStorage("userInfo", {
        name: "张三",
        age: 18
      }).then(() => {
        console.log("存储成功");
      }).catch(err => {
        console.log("存储失败: ", err);
      });

      instance.setStorage("msg", "hello", (err) => {
        if (err) {
          console.log("存储失败: ", err);
          return;
        }

        console.log("存储成功");
      })
    }

    btn2.onclick = () => {
      instance.getStorage("userInfo")
        .then(res => {
          console.log("asyncRes: ", res);
        }).catch(err => {
          console.log("获取失败: ", err);
        });

      instance.getStorage("msg", (err, res) => {
        if (err) {
          console.log("获取失败: ", err);
          return;
        }
        console.log("callbackRes: ", res);
      });
    }

    btn3.onclick = () => {
      setTimeout(() => {
        instance.getStorage("userInfo")
          .then(res => {
            console.log("res: ", res);
          }).catch(err => {
            if (err.flog === LocalstorageOperate.OVERTIME) {
              // 数据已超时
              console.log(err);
            } else if (err.flog === LocalstorageOperate.VOID) {
              // 不存在对应的数据
              console.log(err);
            } else {
              console.log("其他错误: ", err);
            }
          });
      }, 1500);
    }


    btn4.onclick = async () => {
      // TODO 有问题
      const cacheKeys = await instance.getCatchDataKey();
      console.log("cacheKeys: ", cacheKeys);

      const storageInfo = await instance.getStorageInfo();
      console.log("storageInfo: ", storageInfo);
    }

    btn5.onclick = async () => {
      // 删除数据
      // instance.removeStorage()

      // 清除缓存超时的缓存
      // instance.clearOvertimeData()

      // 清空缓存的数据
      await instance.clearDateStorage()
      console.log("success");

      // 清空所有的数据
      // instance.clearStorage()
    }
  </script>
</body>

</html>